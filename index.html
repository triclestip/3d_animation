<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <div id="container">

    </div>
    <script src="js/three.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/GLTFLoader.js"></script>
    <script>
      var clock, container, camera, scene, renderer, controls, listener;
      var ground, house;
      var light;
      var textureLoader = new THREE.TextureLoader();
      var loader = new THREE.GLTFLoader().setPath( '/house/' );
      var isLoaded = false;
      var action = {}, mixer;
      var activeActionName = 'idle';

      var arrAnimations = [
        'idle',
        'run'
      ];
      var actualAnimation = 0;

      init();

      function init() {
        clock = new THREE.Clock();
        scene = new THREE.Scene();
        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        container = document.getElementById('container');
        container.appendChild(renderer.domElement);

        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.2, 2.5);
        // listener = new THREE.AudioListener();
        // camera.add(listener);

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.target = new THREE.Vector3(0, 0.6, 0);

        light = new THREE.AmbientLight(0xffffff, 1);
        scene.add(light);


        loader.load( 'scene.gltf', function ( gltf ) {
          house = gltf.scene;

          mixer = new THREE.AnimationMixer(gltf.scene);

          action.idle = mixer.clipAction(gltf.animations[0]);


          // console.log(house.animations)

          action.idle.setEffectiveWeight(1);
          action.idle.enabled = true;

          action.idle.setLoop();

        	scene.add( house );
          animate();
          isLoaded = true;

          window.addEventListener('click', onDoubleClick, false);



          action.idle.play();
          console.log(action.idle)
        }, undefined, function ( error ) {
        	console.error( error );
        });
      }

      var mylatesttap;
      function onDoubleClick () {
        var now = new Date().getTime();
        var timesince = now - mylatesttap;
        if ((timesince < 600) && (timesince > 0)) {
          if (actualAnimation == arrAnimations.length - 1) {
            actualAnimation = 0;
          } else {
            actualAnimation++;
          }
          fadeAction(arrAnimations[actualAnimation]);

        } else {
          // too much time to be a doubletap
        }

        mylatesttap = new Date().getTime();

      }

      function animate() {
        requestAnimationFrame(animate);
        // controls.update();
        render();
      }
      function render() {
        var delta = clock.getDelta();
        mixer.update(delta);
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
